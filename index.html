<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lckt0's Redirect</title>
</head>
<body>
    <h1>Please wait, redirecting...</h1>
    <script>
        function httpGet(theUrl)
        {
            let xmlhttp;
            if (window.XMLHttpRequest) {
                xmlhttp=new XMLHttpRequest();
            } else {
                xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange=function() {
                if (xmlhttp.readyState==4 && xmlhttp.status==200) {
                    return xmlhttp.responseText;
                }
            }
            xmlhttp.open("GET", theUrl, false);
            xmlhttp.send();   
            return xmlhttp.response;
        }
        var url_param = location.search.split('url=')[1].trim();
        var aim_url;
        const conf = JSON.parse(httpGet(window.location.protocol + "//" + window.location.host + "/redirect_url_options.json"));
        switch(conf[url_param].type){
            case "json_url":
                let j_index = 0; 
                if (conf[url_param].src.startsWith("http")) {
                    j_index++;
                }
                const remote_param = conf[url_param].src.split(':')[2];
                const remote_url = conf[url_param].src.replace(":" + remote_param, "");
                const obj = JSON.parse(httpGet(remote_url));
                alert(obj[remote_param]);
                aim_url=obj[remote_param];
				break;
            case "url":
                aim_url=httpGet(conf[url_param].src).trim();
				break;
			case "raw":
                aim_url=conf[url_param].src;
                break;
            default:
                break;
        }
        window.location.replace(aim_url);
    </script>
</body>
</html>
